<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.1"><title>Mirror Maker 2 - IBM - EDA - Real-time inventory demo</title><link rel=stylesheet href=../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../assets/stylesheets/palette.cbb835fc.min.css><meta name=theme-color content=#000000><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#mirror-maker-2 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="IBM - EDA - Real-time inventory demo" class="md-header__button md-logo" aria-label="IBM - EDA - Real-time inventory demo" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> IBM - EDA - Real-time inventory demo </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Mirror Maker 2 </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="IBM - EDA - Real-time inventory demo" class="md-nav__button md-logo" aria-label="IBM - EDA - Real-time inventory demo" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> IBM - EDA - Real-time inventory demo </label> <div class=md-nav__source> <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../demo-script/ class=md-nav__link> Demonstration script </a> </li> <li class=md-nav__item> <a href=../gitops/ class=md-nav__link> GitOps approach </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Mirror Maker 2 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Mirror Maker 2 </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#activepassive-mirroring class=md-nav__link> Active/Passive Mirroring </a> <nav class=md-nav aria-label="Active/Passive Mirroring"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#pre-requisites class=md-nav__link> Pre-requisites </a> </li> <li class=md-nav__item> <a href=#steps class=md-nav__link> Steps </a> </li> <li class=md-nav__item> <a href=#verification class=md-nav__link> Verification </a> </li> <li class=md-nav__item> <a href=#producing-events-source class=md-nav__link> Producing Events (Source) </a> </li> <li class=md-nav__item> <a href=#consuming-events-target class=md-nav__link> Consuming Events (Target) </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/refarch-eda/ class=md-nav__link> Back to EDA </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#activepassive-mirroring class=md-nav__link> Active/Passive Mirroring </a> <nav class=md-nav aria-label="Active/Passive Mirroring"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#pre-requisites class=md-nav__link> Pre-requisites </a> </li> <li class=md-nav__item> <a href=#steps class=md-nav__link> Steps </a> </li> <li class=md-nav__item> <a href=#verification class=md-nav__link> Verification </a> </li> <li class=md-nav__item> <a href=#producing-events-source class=md-nav__link> Producing Events (Source) </a> </li> <li class=md-nav__item> <a href=#consuming-events-target class=md-nav__link> Consuming Events (Target) </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/edit/master/docs/mm2/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=mirror-maker-2>Mirror Maker 2<a class=headerlink href=#mirror-maker-2 title="Permanent link">&para;</a></h1> <h2 id=activepassive-mirroring>Active/Passive Mirroring<a class=headerlink href=#activepassive-mirroring title="Permanent link">&para;</a></h2> <h3 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h3> <p>This demo presents how to leverage Mirror Maker 2 between two Kafka clusters running on OpenShift. It uses two IBM Event Streams instances on both sides and utilizes mirroring feature that ships as part of IBM Event Streams Operator API's.</p> <ul> <li>Cluster 1 (Active): This will be our source cluster (Source). In this case it can be a Development environment where consumers and producers are connected.</li> <li>Cluster 2 (Passive): This will be our target cluster (Target). In this case it can be a Staging environment where no consumers or producers are connected.</li> </ul> <p>Upon failover, consumers will be connected to the newly promoted cluster (Cluster 2) which will become active.</p> <p>Mirror Maker 2 is a continuous background mirroring process and can be run in its own namespace. However, for the purposes of this demo, it will be created within the destination namespace, in our case <code>rt-inventory-stg</code> and connect to the source Kafka cluser, in our case it is in <code>rt-inventory-dev</code> namespace.</p> <p><img alt=Architecture src=images/mm2-arch.jpeg></p> <h3 id=pre-requisites>Pre-requisites<a class=headerlink href=#pre-requisites title="Permanent link">&para;</a></h3> <ul> <li>We assume, you have access to one or two separate OpenShift clusters.</li> <li>The OpenShift cluster(s) has/have IBM Event Streams Operator version 3.0.x installed and available for all namespaces on the cluster(s).</li> </ul> <h3 id=steps>Steps<a class=headerlink href=#steps title="Permanent link">&para;</a></h3> <p>1- Creating Source (Origin) Kafka Cluster:</p> <ul> <li>Using Web Console on the first OpenShift cluster, create a new project named <code>rt-inventory-dev</code></li> <li>Make sure that this project is selected and create a new EventStreams instance named <code>rt-inventory-dev</code> inside it.</li> </ul> <div class="admonition note"> <p class=admonition-title>Note<p>This cluster represents the Development Environment (Active)</p> </p> </div> <ul> <li> <p>Once the EventStreams instance <code>rt-inventory-dev</code> is up and running, access its Admin UI to perform the below sub-tasks:</p> <ul> <li>Create SCRAM credentials with username <code>rt-inv-dev-user</code>. This will create <code>rt-inv-dev-user</code> secret.</li> <li>Take a note of the SCRAM username and password.</li> <li>Take a note of the bootstrap Server address.</li> <li>Generate TLS certificates. This will create <code>rt-inventory-dev-cluster-ca-cert</code> secret.</li> <li>Download and save the PEM certificate. You could rename it to <code>es-src-cert.pem</code>.</li> <li>Create Kafka topics <code>items</code>, <code>items.inventory</code>, and <code>store.inventory</code> which will be used to demonstrate replication from source to target.</li> </ul> </li> </ul> <div class="admonition note"> <p class=admonition-title>Note<p>The above two created secrets will need to be copied to the target cluster so Mirror Maker 2 can reference them to connect to the source cluster</p> </p> </div> <p>2- Creating Target (Destination) Kafka Cluster:</p> <ul> <li>Using Web Console on the first OpenShift cluster, create a new project named <code>rt-inventory-stg</code></li> <li>Make sure that this project is selected and create a new EventStreams instance named <code>rt-inventory-stg</code> inside it.</li> </ul> <div class="admonition note"> <p class=admonition-title>Note<p>This cluster represents the Staging Environment (Passive)</p> </p> </div> <ul> <li> <p>Once the EventStreams instance <code>rt-inventory-stg</code> is up and running, access its Admin UI to perform the below sub-tasks:</p> <ul> <li>Create SCRAM credentials with username <code>rt-inv-stg-user</code>. This will create <code>rt-inv-stg-user</code> secret.</li> <li>Take a note of the SCRAM username and password.</li> <li>Take a note of the bootstrap Server address.</li> <li>Generate TLS certificates. This will create <code>rt-inventory-stg-cluster-ca-cert</code> secret.</li> <li>Download and save the PEM certificate. You could rename it to <code>es-tgt-cert.pem</code>.</li> </ul> </li> </ul> <div class="admonition note"> <p class=admonition-title>Note<p>Mirror Maker 2 will reference the above two created secrets to connect to the target cluster</p> </p> </div> <p>3- Creating MirrorMaker 2 instance:</p> <ul> <li>Make sure that <code>rt-inventory-stg</code> project is selected.</li> <li>Create the two sercets generated from Step 1 by copying their yaml configs from <code>rt-inventory-dev</code> project to preserve the names.</li> <li>Using OpenShift Web Console (Administrator perspective), navigate to Operators -&gt; Installed Operators.</li> <li>On the Installed Operators page, click on <code>IBM Event Sreams</code>.</li> <li>On the Avialable API's page, find <code>Kafka Mirror Maker 2</code> then click <code>Create instance</code>.</li> </ul> <p><img alt="MM2 Create" src=images/mm2-create.jpeg></p> <ul> <li>Select Configure via YAML view to use the <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/blob/main/environments/rt-inventory-stage/services/mm2/mm2-config.yaml>yaml file</a> provided in this demo.</li> </ul> <p><img alt="MM2 Yaml" src=images/mm2-yaml.jpeg></p> <ul> <li>Change the <code>bootstrapServers</code> address (line 36) to be the address of your Source Kafka bootstrapServer (from Step 1).</li> <li>Change the <code>bootstrapServers</code> address (line 53) to be the address of your Target Kafka bootstrapServer (from Step 2).</li> </ul> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1> 1</a></span>
<span class=normal><a href=#__codelineno-0-2> 2</a></span>
<span class=normal><a href=#__codelineno-0-3> 3</a></span>
<span class=normal><a href=#__codelineno-0-4> 4</a></span>
<span class=normal><a href=#__codelineno-0-5> 5</a></span>
<span class=normal><a href=#__codelineno-0-6> 6</a></span>
<span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span>
<span class=normal><a href=#__codelineno-0-77>77</a></span>
<span class=normal><a href=#__codelineno-0-78>78</a></span>
<span class=normal><a href=#__codelineno-0-79>79</a></span>
<span class=normal><a href=#__codelineno-0-80>80</a></span>
<span class=normal><a href=#__codelineno-0-81>81</a></span>
<span class=normal><a href=#__codelineno-0-82>82</a></span>
<span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span>
<span class=normal><a href=#__codelineno-0-86>86</a></span>
<span class=normal><a href=#__codelineno-0-87>87</a></span>
<span class=normal><a href=#__codelineno-0-88>88</a></span>
<span class=normal><a href=#__codelineno-0-89>89</a></span>
<span class=normal><a href=#__codelineno-0-90>90</a></span>
<span class=normal><a href=#__codelineno-0-91>91</a></span>
<span class=normal><a href=#__codelineno-0-92>92</a></span>
<span class=normal><a href=#__codelineno-0-93>93</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">eventstreams.ibm.com/v1beta2</span><span class=w></span>
<a id=__codelineno-0-2 name=__codelineno-0-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">KafkaMirrorMaker2</span><span class=w></span>
<a id=__codelineno-0-3 name=__codelineno-0-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-4 name=__codelineno-0-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mm2</span><span class=w></span>
<a id=__codelineno-0-5 name=__codelineno-0-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rt-inventory-stg</span><span class=w>  </span>
<a id=__codelineno-0-6 name=__codelineno-0-6></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-7 name=__codelineno-0-7></a><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3.0.1</span><span class=w></span>
<a id=__codelineno-0-8 name=__codelineno-0-8></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w></span>
<a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=w>  </span><span class=nt>connectCluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">es-tgt</span><span class=w></span>
<a id=__codelineno-0-10 name=__codelineno-0-10></a><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-11 name=__codelineno-0-11></a><span class=w>    </span><span class=nt>loggers</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-12 name=__codelineno-0-12></a><span class=w>      </span><span class=nt>connect.root.logger.level</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span><span class=w></span>
<a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">inline</span><span class=w></span>
<a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-15 name=__codelineno-0-15></a><span class=w>    </span><span class=nt>pod</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-16 name=__codelineno-0-16></a><span class=w>      </span><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-17 name=__codelineno-0-17></a><span class=w>        </span><span class=nt>annotations</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=w>          </span><span class=nt>cloudpakId</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">c8b82d189e7545f0892db9ef2731b90d</span><span class=w></span>
<a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=w>          </span><span class=nt>productVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">11.0.0</span><span class=w></span>
<a id=__codelineno-0-20 name=__codelineno-0-20></a><span class=w>          </span><span class=nt>productID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2a79e49111f44ec3acd89608e56138f5</span><span class=w></span>
<a id=__codelineno-0-21 name=__codelineno-0-21></a><span class=w>          </span><span class=nt>cloudpakName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IBM Cloud Pak for Integration</span><span class=w></span>
<a id=__codelineno-0-22 name=__codelineno-0-22></a><span class=w>          </span><span class=nt>cloudpakVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2022.1.1</span><span class=w></span>
<a id=__codelineno-0-23 name=__codelineno-0-23></a><span class=w>          </span><span class=nt>productChargedContainers</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mm2-mirrormaker2</span><span class=w></span>
<a id=__codelineno-0-24 name=__codelineno-0-24></a><span class=w>          </span><span class=nt>productCloudpakRatio</span><span class=p>:</span><span class=w> </span><span class=s>&#39;2:1&#39;</span><span class=w></span>
<a id=__codelineno-0-25 name=__codelineno-0-25></a><span class=w>          </span><span class=nt>productName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IBM Event Streams for Non Production</span><span class=w></span>
<a id=__codelineno-0-26 name=__codelineno-0-26></a><span class=w>          </span><span class=nt>eventstreams.production.type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CloudPakForIntegrationNonProduction</span><span class=w></span>
<a id=__codelineno-0-27 name=__codelineno-0-27></a><span class=w>          </span><span class=nt>productMetric</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VIRTUAL_PROCESSOR_CORE</span><span class=w></span>
<a id=__codelineno-0-28 name=__codelineno-0-28></a><span class=w>  </span><span class=nt>clusters</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-29 name=__codelineno-0-29></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">es-src</span><span class=w></span>
<a id=__codelineno-0-30 name=__codelineno-0-30></a><span class=w>      </span><span class=nt>authentication</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-31 name=__codelineno-0-31></a><span class=w>        </span><span class=nt>passwordSecret</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-32 name=__codelineno-0-32></a><span class=w>          </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span><span class=w></span>
<a id=__codelineno-0-33 name=__codelineno-0-33></a><span class=w>          </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rt-inv-dev-user</span><span class=w></span>
<a id=__codelineno-0-34 name=__codelineno-0-34></a><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">scram-sha-512</span><span class=w></span>
<a id=__codelineno-0-35 name=__codelineno-0-35></a><span class=w>        </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rt-inv-dev-user</span><span class=w></span>
<a id=__codelineno-0-36 name=__codelineno-0-36></a><span class=hll><span class=w>      </span><span class=nt>bootstrapServers</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rt-inventory-dev-kafka-bootstrap-rt-inventory-dev.itzroks-4b4a.us-south.containers.appdomain.cloud:443</span><span class=w></span>
</span><a id=__codelineno-0-37 name=__codelineno-0-37></a><span class=w>      </span><span class=nt>config</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-38 name=__codelineno-0-38></a><span class=w>        </span><span class=nt>ssl.endpoint.identification.algorithm</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https</span><span class=w>      </span>
<a id=__codelineno-0-39 name=__codelineno-0-39></a><span class=w>        </span><span class=nt>config.storage.replication.factor</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w></span>
<a id=__codelineno-0-40 name=__codelineno-0-40></a><span class=w>        </span><span class=nt>offset.storage.replication.factor</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w></span>
<a id=__codelineno-0-41 name=__codelineno-0-41></a><span class=w>        </span><span class=nt>status.storage.replication.factor</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w></span>
<a id=__codelineno-0-42 name=__codelineno-0-42></a><span class=w>      </span><span class=nt>tls</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-43 name=__codelineno-0-43></a><span class=w>        </span><span class=nt>trustedCertificates</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-44 name=__codelineno-0-44></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>certificate</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ca.crt</span><span class=w></span>
<a id=__codelineno-0-45 name=__codelineno-0-45></a><span class=w>            </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rt-inventory-dev-cluster-ca-cert</span><span class=w></span>
<a id=__codelineno-0-46 name=__codelineno-0-46></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">es-tgt</span><span class=w></span>
<a id=__codelineno-0-47 name=__codelineno-0-47></a><span class=w>      </span><span class=nt>authentication</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-48 name=__codelineno-0-48></a><span class=w>        </span><span class=nt>passwordSecret</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-49 name=__codelineno-0-49></a><span class=w>          </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span><span class=w></span>
<a id=__codelineno-0-50 name=__codelineno-0-50></a><span class=w>          </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rt-inv-stg-user</span><span class=w></span>
<a id=__codelineno-0-51 name=__codelineno-0-51></a><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">scram-sha-512</span><span class=w></span>
<a id=__codelineno-0-52 name=__codelineno-0-52></a><span class=w>        </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rt-inv-stg-user</span><span class=w></span>
<a id=__codelineno-0-53 name=__codelineno-0-53></a><span class=hll><span class=w>      </span><span class=nt>bootstrapServers</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rt-inventory-stg-kafka-bootstrap-rt-inventory-stg.itzroks-4b4b.us-south.containers.appdomain.cloud:443</span><span class=w></span>
</span><a id=__codelineno-0-54 name=__codelineno-0-54></a><span class=w>      </span><span class=nt>config</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-55 name=__codelineno-0-55></a><span class=w>        </span><span class=nt>ssl.endpoint.identification.algorithm</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https</span><span class=w>      </span>
<a id=__codelineno-0-56 name=__codelineno-0-56></a><span class=w>        </span><span class=nt>config.storage.replication.factor</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class=w></span>
<a id=__codelineno-0-57 name=__codelineno-0-57></a><span class=w>        </span><span class=nt>offset.storage.replication.factor</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class=w></span>
<a id=__codelineno-0-58 name=__codelineno-0-58></a><span class=w>        </span><span class=nt>status.storage.replication.factor</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class=w>    </span>
<a id=__codelineno-0-59 name=__codelineno-0-59></a><span class=w>      </span><span class=nt>tls</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-60 name=__codelineno-0-60></a><span class=w>        </span><span class=nt>trustedCertificates</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-61 name=__codelineno-0-61></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>certificate</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ca.crt</span><span class=w></span>
<a id=__codelineno-0-62 name=__codelineno-0-62></a><span class=w>            </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rt-inventory-stg-cluster-ca-cert</span><span class=w></span>
<a id=__codelineno-0-63 name=__codelineno-0-63></a><span class=w>  </span><span class=nt>mirrors</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-64 name=__codelineno-0-64></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>sourceCluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">es-src</span><span class=w></span>
<a id=__codelineno-0-65 name=__codelineno-0-65></a><span class=w>      </span><span class=nt>targetCluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">es-tgt</span><span class=w> </span>
<a id=__codelineno-0-66 name=__codelineno-0-66></a><span class=w>      </span><span class=nt>sourceConnector</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-67 name=__codelineno-0-67></a><span class=w>        </span><span class=nt>config</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-68 name=__codelineno-0-68></a><span class=w>          </span><span class=c1># the replication factor that will be used for</span><span class=w></span>
<a id=__codelineno-0-69 name=__codelineno-0-69></a><span class=w>          </span><span class=c1>#  all topics created on the &quot;target&quot; Kafka cluster</span><span class=w></span>
<a id=__codelineno-0-70 name=__codelineno-0-70></a><span class=w>          </span><span class=nt>replication.factor</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class=w></span>
<a id=__codelineno-0-71 name=__codelineno-0-71></a><span class=w>          </span><span class=c1># don&#39;t try to copy permissions across from the &quot;origin&quot;</span><span class=w></span>
<a id=__codelineno-0-72 name=__codelineno-0-72></a><span class=w>          </span><span class=c1>#  cluster to the &quot;target&quot; cluster</span><span class=w></span>
<a id=__codelineno-0-73 name=__codelineno-0-73></a><span class=w>          </span><span class=nt>sync.topic.acls.enabled</span><span class=p>:</span><span class=w> </span><span class=s>&quot;false&quot;</span><span class=w>          </span>
<a id=__codelineno-0-74 name=__codelineno-0-74></a><span class=w>          </span><span class=nt>replication.policy.separator</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w></span>
<a id=__codelineno-0-75 name=__codelineno-0-75></a><span class=w>          </span><span class=nt>replication.policy.class</span><span class=p>:</span><span class=w> </span><span class=s>&quot;io.strimzi.kafka.connect.mirror.IdentityReplicationPolicy&quot;</span><span class=w></span>
<a id=__codelineno-0-76 name=__codelineno-0-76></a><span class=w>          </span><span class=nt>offset-syncs.topic.replication.factor</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class=w></span>
<a id=__codelineno-0-77 name=__codelineno-0-77></a><span class=w>          </span><span class=nt>refresh.topics.interval.seconds </span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class=w></span>
<a id=__codelineno-0-78 name=__codelineno-0-78></a><span class=w>      </span><span class=nt>checkpointConnector</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-79 name=__codelineno-0-79></a><span class=w>        </span><span class=nt>config</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-0-80 name=__codelineno-0-80></a><span class=w>          </span><span class=nt>checkpoints.topic.replication.factor</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class=w></span>
<a id=__codelineno-0-81 name=__codelineno-0-81></a><span class=w>          </span><span class=nt>refresh.groups.interval.seconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class=w></span>
<a id=__codelineno-0-82 name=__codelineno-0-82></a><span class=w>          </span><span class=c1># migrates the consumer group offsets</span><span class=w></span>
<a id=__codelineno-0-83 name=__codelineno-0-83></a><span class=w>          </span><span class=nt>emit.checkpoints.enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a id=__codelineno-0-84 name=__codelineno-0-84></a><span class=w>          </span><span class=nt>sync.group.offsets.enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a id=__codelineno-0-85 name=__codelineno-0-85></a><span class=w>          </span><span class=nt>sync.group.offsets.interval.seconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class=w></span>
<a id=__codelineno-0-86 name=__codelineno-0-86></a><span class=w>          </span><span class=nt>emit.checkpoints.interval.seconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class=w></span>
<a id=__codelineno-0-87 name=__codelineno-0-87></a><span class=w>          </span><span class=c1># ensures that consumer group offsets on the &quot;target&quot; cluster</span><span class=w></span>
<a id=__codelineno-0-88 name=__codelineno-0-88></a><span class=w>          </span><span class=c1>#  are correctly mapped to consumer groups on the &quot;origin&quot; cluster</span><span class=w></span>
<a id=__codelineno-0-89 name=__codelineno-0-89></a><span class=w>          </span><span class=nt>replication.policy.class</span><span class=p>:</span><span class=w> </span><span class=s>&quot;io.strimzi.kafka.connect.mirror.IdentityReplicationPolicy&quot;</span><span class=w></span>
<a id=__codelineno-0-90 name=__codelineno-0-90></a><span class=w>          </span><span class=nt>replication.policy.separator</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w>          </span>
<a id=__codelineno-0-91 name=__codelineno-0-91></a><span class=w>      </span><span class=nt>topicsPattern</span><span class=p>:</span><span class=w> </span><span class=s>&quot;items,</span><span class=nv> </span><span class=s>store.inventory,</span><span class=nv> </span><span class=s>items.inventory&quot;</span><span class=w></span>
<a id=__codelineno-0-92 name=__codelineno-0-92></a><span class=w>      </span><span class=nt>topicsExcludePattern</span><span class=p>:</span><span class=w> </span><span class=s>&quot;.apicurio&quot;</span><span class=w></span>
<a id=__codelineno-0-93 name=__codelineno-0-93></a><span class=w>      </span><span class=nt>groupsPattern</span><span class=p>:</span><span class=w> </span><span class=s>&quot;.*&quot;</span><span class=w> </span>
</code></pre></div></td></tr></table></div> <ul> <li>If the same namespaces and SCRAM usernames are used as indicated in the previous steps, no further changes are required.</li> <li>Click <code>Create</code> to apply the YAML changes and create <code>KafkaMirrorMaker2</code> instance.</li> <li>In few seconds, check the status of <code>KafkaMirrorMaker2</code> instance from Kafka Mirror Maker 2 Tab.</li> <li>The status should be <code>Condition: Ready</code>.</li> </ul> <p><img alt="MM2 Status" src=images/mm2-status.jpeg></p> <ul> <li><code>KafkaMirrorMaker2</code> instance created <code>mm2</code> will deploy different resources that can be checked from its <code>Resources</code> Tab.</li> <li>You might need to check the created <code>Pod</code> resource log for errors or warnings.</li> </ul> <p><img alt="MM2 Status" src=images/mm2-resources.jpeg></p> <ul> <li>Now, the created instance <code>mm2</code> will start to mirror (replicate) the Kafka topics' events, and offsets from source to the target cluster.</li> <li>Only Kafka topics specified in <code>topicsPattern</code> will be replicated and topics specified in <code>topicsExcludePattern</code> will be excluded.</li> </ul> <h3 id=verification>Verification<a class=headerlink href=#verification title="Permanent link">&para;</a></h3> <ul> <li>Access the EventStreams instance <code>rt-inventory-stg</code> Admin UI to verify that the replication is working.</li> <li>From the side menu, select Topics to see the list of Kafka topics created on our Target cluster (Staging Environment).</li> </ul> <p><img alt="MM2 Status" src=images/mm2-topics.jpeg></p> <ul> <li>You can see that <code>items</code>, <code>items.inventory</code>, and <code>store.inventory</code> Kafka topics were created and events are being replicated.</li> <li>Kafka Topics named <code>mirrormaker2-cluster-xxx</code> are used internally by our <code>KafkaMirrorMaker2</code> instance to keep track of configs, offsets, and replication status.</li> <li>Click on <code>items</code> topic then visit the Messages Tab to see that the events are being replicated as they arrive to the Source cluster. The next section will demonstrate how to produce sample events to the Source cluster.</li> </ul> <p><img alt="MM2 Status" src=images/mm2-events.jpeg></p> <h3 id=producing-events-source>Producing Events (Source)<a class=headerlink href=#producing-events-source title="Permanent link">&para;</a></h3> <p>This section will be used to verify that the replication of messages (Kafka events) is actually happening (live events feed is moving from Source to Target). We will use a simple python script (accompanied with a starter bash script) that connects to the Source cluster and sends a random json payloads to the <code>items</code> topic created in Step 1.</p> <p>The producer script requires Python 3.x with <code>confluent-kafka</code> Kakfa library installed. To install the Kafka library, run:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>pip install confluent-kafka
</code></pre></div> <p>Perform the following steps to setup the producer sample application:</p> <ol> <li>On your local machine, create a new directory named <code>producer</code>.</li> <li>Download and save <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/blob/main/demo/mm2/scripts/SendItems.py><code>SendItems.py</code></a> and <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/blob/main/demo/mm2/scripts/sendItems.sh><code>sendItems.sh</code></a> files inside <code>producer</code> directory.</li> <li>Move the Source cluster PEM certificate file <code>es-src-cert.pem</code> to the same directory.</li> <li>Edit the <code>sendItems.sh</code> script to set the environment variables of Source cluster connectivity configs.<ul> <li>Change the <code>KAFKA_BROKERS</code> variable to the Source cluster bootstrap address.</li> <li>Change the <code>KAFKA_PWD</code> variable to be the password of <code>rt-inv-dev-user</code> SCRAM user.</li> </ul> </li> </ol> <p><div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=nb>export</span> <span class=nv>KAFKA_BROKERS</span><span class=o>=</span>rt-inventory-dev-kafka-bootstrap-rt-inventory-dev.itzroks-4b4a.us-south.containers.appdomain.cloud:443
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=nb>export</span> <span class=nv>KAFKA_USER</span><span class=o>=</span>rt-inv-dev-user
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=nb>export</span> <span class=nv>KAFKA_PWD</span><span class=o>=</span>SCRAM-PASSWORD
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=nb>export</span> <span class=nv>KAFKA_CERT</span><span class=o>=</span>es-src-cert.pem
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=nb>export</span> <span class=nv>KAFKA_SECURITY_PROTOCOL</span><span class=o>=</span>SASL_SSL
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=nb>export</span> <span class=nv>KAFKA_SASL_MECHANISM</span><span class=o>=</span>SCRAM-SHA-512
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=nb>export</span> <span class=nv>SOURCE_TOPIC</span><span class=o>=</span>items
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>python SendItems.py <span class=nv>$1</span>
</code></pre></div> 5. Now you can run the shell script and pass the number of events to be sent as an argument.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>./sendItems.sh <span class=m>10</span>
</code></pre></div> <h3 id=consuming-events-target>Consuming Events (Target)<a class=headerlink href=#consuming-events-target title="Permanent link">&para;</a></h3> <p>This section will simulate failover to Target (passive) cluster. MirrorMaker 2 uses <code>checkpointConnector</code> to automatically store consumer group offset checkpoints for consumer groups on the Source Kafka cluster. Each checkpoint maps the last committed offset for each consumer group in the Source cluster to the equivalent offset in the Target cluster.</p> <p>These checkpoints will be used by our Kafka consumer script to start consuming from an offset on the Target cluster that is equivalent to the last committed offset on the Source cluster.</p> <p>The same way we used to setup the Producer application, we need to perform the following steps to setup the Consumer application:</p> <ol> <li>On your local machine, create a new directory named <code>consumer</code>.</li> <li>Download and save <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/blob/main/demo/mm2/scripts/ReceiveItems.py><code>ReceiveItems.py</code></a> and <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/blob/main/demo/mm2/scripts/receiveItems.sh><code>receiveItems.sh</code></a> files inside <code>consumer</code> directory.</li> <li>Move the Target cluster PEM certificate file <code>es-tgt-cert.pem</code> to the same directory.</li> <li>Edit the <code>receiveItems.sh</code> script to set the environment variables of Target cluster connectivity configs.<ul> <li>Change the <code>KAFKA_BROKERS</code> variable to the Target cluster bootstrap address.</li> <li>Change the <code>KAFKA_PWD</code> variable to be the password of <code>rt-inv-stg-user</code> SCRAM user.</li> </ul> </li> </ol> <p><div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=nb>export</span> <span class=nv>KAFKA_BROKERS</span><span class=o>=</span>rt-inventory-stg-kafka-bootstrap-rt-inventory-stg.itzroks-4b4b.us-south.containers.appdomain.cloud:443
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=nb>export</span> <span class=nv>KAFKA_USER</span><span class=o>=</span>rt-inv-stg-user
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=nb>export</span> <span class=nv>KAFKA_PWD</span><span class=o>=</span>SCRAM-PASSWORD
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=nb>export</span> <span class=nv>KAFKA_CERT</span><span class=o>=</span>es-tgt-cert.pem
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=nb>export</span> <span class=nv>KAFKA_SECURITY_PROTOCOL</span><span class=o>=</span>SASL_SSL
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=nb>export</span> <span class=nv>KAFKA_SASL_MECHANISM</span><span class=o>=</span>SCRAM-SHA-512
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=nb>export</span> <span class=nv>SOURCE_TOPIC</span><span class=o>=</span>items
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>python ReceiveItems.py <span class=nv>$1</span>
</code></pre></div> 5. Now you can run the shell script and pass the number of events to be consumed as an argument.</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>./consumeItems.sh <span class=m>10</span>
</code></pre></div> 6. You should see the mirrored messages now in <code>items</code> replicated topic in our Target Kafka cluster.</p> <div class="admonition note"> <p class=admonition-title>Note<p>To check the current and offset lag, you can use Event Streams UI on Target cluster.</p> </p> </div> <p><img alt="MM2 Consumer  " src=images/mm2-consumer.jpeg></p> <p>We can see that the consumer application has started to read from the last committed offset.</p> <p>This concludes our Kafka Mirror Maker 2 Active/Passive mode replication demo.</p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../gitops/ class="md-footer__link md-footer__link--prev" aria-label="Previous: GitOps approach" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> GitOps approach </div> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.indexes", "navigation.tracking", "navigation.tabs.sticky"], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../assets/javascripts/bundle.9c69f0bc.min.js></script> </body> </html>