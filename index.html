<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.1"><title>IBM - EDA - Real-time inventory demo</title><link rel=stylesheet href=assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=assets/stylesheets/palette.cbb835fc.min.css><meta name=theme-color content=#000000><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=extra.css><script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#real-time-inventory-demonstration class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=. title="IBM - EDA - Real-time inventory demo" class="md-header__button md-logo" aria-label="IBM - EDA - Real-time inventory demo" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> IBM - EDA - Real-time inventory demo </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Introduction </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=. title="IBM - EDA - Real-time inventory demo" class="md-nav__button md-logo" aria-label="IBM - EDA - Real-time inventory demo" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> IBM - EDA - Real-time inventory demo </label> <div class=md-nav__source> <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Introduction <span class="md-nav__icon md-icon"></span> </label> <a href=. class="md-nav__link md-nav__link--active"> Introduction </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#what-you-will-learn class=md-nav__link> What you will learn </a> </li> <li class=md-nav__item> <a href=#why-to-consider class=md-nav__link> Why to consider </a> </li> <li class=md-nav__item> <a href=#use-case-overview class=md-nav__link> Use Case Overview </a> </li> <li class=md-nav__item> <a href=#demonstration-components class=md-nav__link> Demonstration components </a> </li> <li class=md-nav__item> <a href=#general-pre-requisites class=md-nav__link> General pre-requisites </a> </li> <li class=md-nav__item> <a href=#a-gitops-approach-for-solution-deployment class=md-nav__link> A GitOps approach for solution deployment </a> </li> <li class=md-nav__item> <a href=#choose-a-runtime-option class=md-nav__link> Choose a runtime option </a> </li> <li class=md-nav__item> <a href=#a-non-gitops-approach class=md-nav__link> A non gitops approach </a> <nav class=md-nav aria-label="A non gitops approach"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deploy-on-a-brand-new-openshift-cluster class=md-nav__link> Deploy on a brand new OpenShift cluster </a> </li> <li class=md-nav__item> <a href=#deploy-on-multi-tenant-environment class=md-nav__link> Deploy on multi-tenant environment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#two-different-streaming-approaches class=md-nav__link> Two different streaming approaches </a> <nav class=md-nav aria-label="Two different streaming approaches"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kafka-streams-implementation class=md-nav__link> Kafka Streams implementation </a> </li> <li class=md-nav__item> <a href=#fink-implementation class=md-nav__link> Fink implementation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#run-the-solution-locally class=md-nav__link> Run the solution locally </a> <nav class=md-nav aria-label="Run the solution locally"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#demonstration-script-for-local class=md-nav__link> Demonstration script for local </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=demo-script/ class=md-nav__link> Demonstration script </a> </li> <li class=md-nav__item> <a href=gitops/ class=md-nav__link> GitOps approach </a> </li> <li class=md-nav__item> <a href=mm2/ class=md-nav__link> Mirror Maker 2 </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/refarch-eda/ class=md-nav__link> Back to EDA </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#what-you-will-learn class=md-nav__link> What you will learn </a> </li> <li class=md-nav__item> <a href=#why-to-consider class=md-nav__link> Why to consider </a> </li> <li class=md-nav__item> <a href=#use-case-overview class=md-nav__link> Use Case Overview </a> </li> <li class=md-nav__item> <a href=#demonstration-components class=md-nav__link> Demonstration components </a> </li> <li class=md-nav__item> <a href=#general-pre-requisites class=md-nav__link> General pre-requisites </a> </li> <li class=md-nav__item> <a href=#a-gitops-approach-for-solution-deployment class=md-nav__link> A GitOps approach for solution deployment </a> </li> <li class=md-nav__item> <a href=#choose-a-runtime-option class=md-nav__link> Choose a runtime option </a> </li> <li class=md-nav__item> <a href=#a-non-gitops-approach class=md-nav__link> A non gitops approach </a> <nav class=md-nav aria-label="A non gitops approach"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deploy-on-a-brand-new-openshift-cluster class=md-nav__link> Deploy on a brand new OpenShift cluster </a> </li> <li class=md-nav__item> <a href=#deploy-on-multi-tenant-environment class=md-nav__link> Deploy on multi-tenant environment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#two-different-streaming-approaches class=md-nav__link> Two different streaming approaches </a> <nav class=md-nav aria-label="Two different streaming approaches"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kafka-streams-implementation class=md-nav__link> Kafka Streams implementation </a> </li> <li class=md-nav__item> <a href=#fink-implementation class=md-nav__link> Fink implementation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#run-the-solution-locally class=md-nav__link> Run the solution locally </a> <nav class=md-nav aria-label="Run the solution locally"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#demonstration-script-for-local class=md-nav__link> Demonstration script for local </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/edit/master/docs/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=real-time-inventory-demonstration>Real-time inventory demonstration<a class=headerlink href=#real-time-inventory-demonstration title="Permanent link">&para;</a></h1> <p>This repository uses OpenShift GitOps to manage the deployment of the real-time inventory demonstration. </p> <h2 id=what-you-will-learn>What you will learn<a class=headerlink href=#what-you-will-learn title="Permanent link">&para;</a></h2> <ul> <li>Use Quarkus, with reactive programming API like Mutiny, and Kafka API to produce messages to Kafka</li> <li>Same Quarkus app can generate messages to RabbitMQ using the AMQP API</li> <li>Same Quarkus app can generate messages to IBM MQ using JMS</li> <li>Use Quarkus and Kafka Streams to compute aggregates to build an inventory view from the stream of sale order events</li> <li>Use IBM Event Streams, Kafka Connector</li> <li>Use the RabbitMQ source connector from IBM Event messaging open source contribution</li> <li>Use the IBM MQ source connector from IBM Event messaging open source contribution</li> </ul> <h2 id=why-to-consider>Why to consider<a class=headerlink href=#why-to-consider title="Permanent link">&para;</a></h2> <p>This project can be a good foundation to discuss GitOps deployment, and reuse scripts, makefile... to deploy any event-driven solution.</p> <p>As a developer you will use Microprofile reactive messaging, Kafka Streams API, Quarkus and OpenLiberty. Kafka IBM MQ source connector from IBM Event messaging github, Elastic search sink connector...</p> <h2 id=use-case-overview>Use Case Overview<a class=headerlink href=#use-case-overview title="Permanent link">&para;</a></h2> <p>Today, a lot of companies which are managing item / product inventory are facing real challenges to get a close to real-time view of item availability and global inventory view. The solution can be very complex to implement while integrating Enterprise Resource Planning products and other custom legacy systems. </p> <p><img alt src=images/hl-solution.png></p> <p>Any new solutions are adopting events as a source to exchange data, to put less pressure on existing ERP servers, and to get better visibility into inventory positions while bringing agility to develop new solution with streaming components.</p> <p>This scenario implements a simple near real-time inventory management solution based on real life MVPs we developed in 2020 for different customers. The demonstration illustrates how event streaming processing help to build inventory views.</p> <p>A production deployment will implement different level of store and warehouse inventory aggregators that will push results as events to an event backbone, which in our case is IBM Event Streams.</p> <p>Servers in the Store are sending sale transactions to a central messaging platform, where streaming components are computing the different aggregates. This is a classical data streaming pipeline. Sink connectors, based on Kafka Connect framework, may be used to move data to long persistence storage like object storage or a Database, to integrate results back to Legacy ERP, to use indexing product like Elastic Search, or to propagate events to dashboards.</p> <p>In real life, an as-is solution will include back-end applications to manage the warehouses inventory, connected to a home-built fulfillment application, combined with store applications and servers, e-commerce suite, and a set of SOA services exposing backend systems. This is the larger view of the following figure:</p> <p><img alt src=images/as-is-soa.png></p> <p>We may have integration flows to do data mapping, but most of those calls are synchronous. To get item availability, a lot of SOAP calls are done, increasing latency, and the risk of failure. There is <a href="https://www.youtube.com/watch?v=FskIb9SariI">an interesting video</a> from Scott Havens explaining the needs from transitioning from a synchronous architecture to an event-driven asynchronous architecture when scaling, and low latency are must have. This lab reflects this approach.</p> <h2 id=demonstration-components>Demonstration components<a class=headerlink href=#demonstration-components title="Permanent link">&para;</a></h2> <p>The demonstration may be used with different level of integration, and you can select those <code>a la carte</code>. The following diagram illustrates the current components:</p> <p><img alt src=images/mq-es-demo.png></p> <p>Diagram source: <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/blob/main/docs/diagrams/mq-es-demo.drawio>rt-inventory diagram</a></p> <ol> <li>The <a href=https://github.com/ibm-cloud-architecture/refarch-eda-store-simulator>store simulator application</a> is a Quarkus based microservice, used to generate item sales to different possible messaging middlewares ( RabbitMQ, IBM MQ or directly to IBM Event Streams). If you want to browse the code, the main <a href=https://github.com/ibm-cloud-architecture/refarch-eda-store-simulator>readme of this project</a> includes how to package and run the app with docker compose. A code explanation section may give you some ideas to developers. The docker image is <a href=https://quay.io/ibmcase/eda-store-simulator>quay.io/ibmcase/eda-store-simulator/</a> and can be used for demonstration.</li> <li>The item inventory aggregator is a stateful application, done with Kafka Stream API. The source code is in <a href=https://github.com/ibm-cloud-architecture/refarch-eda-item-inventory>the refarch-eda-item-inventory project</a>. Consider this more as a black box in the context of the scenario, it consumes items events, aggregate them, expose APIs on top of Kafka Streams interactive queries and publishes inventory events on <code>item.inventory</code> topic. As a developer you may want to understand the Kafka Stream programming with the <a href=https://ibm-cloud-architecture.github.io/refarch-eda/use-cases/kafka-streams/ >following labs</a>, and then considering looking at the classes: <a href=https://github.com/ibm-cloud-architecture/refarch-eda-item-inventory/blob/master/src/main/java/ibm/gse/eda/inventory/domain/ItemProcessingAgent.java>ItemProcessingAgent.java</a>.</li> <li>The store inventory aggregator is a Kafka Stream application, also done with Kafka Stream API. The source code is in <a href=https://github.com/ibm-cloud-architecture/refarch-eda-store-inventory>the refarch-eda-store-inventory project</a>. The output is in <code>store.inventory</code> topic. </li> <li>When messages are sourced to Queues, then a Kafka Source Connector is used to propagate message to <code>items</code> topics. The MQ to Kafka Kafka connect cluster is defined in the <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops>eda-rt-inventory-GitOps</a> repository under the <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/tree/main/kconnect>kconnect</a> folder, and the source connector in <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/blob/main/environments/rt-inventory-dev/apps/mq-source>environments/rt-inventory-dev/apps/mq-source</a></li> <li>The Kafka to Cloud Object Storage Kafka (S3 bucket) connector is defined in the <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/blob/main/environments/rt-inventory-dev/apps/cos-sink/kafka-cos-sink-connector.yaml>environments/rt-inventory-dev/apps/cos-sink folder</a>.</li> <li>The Sink connector to Elastic Search is defined in <a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/blob/main/environments/rt-inventory-dev/apps/elastic-sink/kafka-elastic-sink-connector.yaml>environments/rt-inventory-dev/apps/elastic-sink folder</a>.</li> </ol> <p><a href=https://ibm-cloud-architecture.github.io/refarch-eda/technology/kafka-connect/ >Kafka Connect</a> is used to integrate external systems into Kafka. For example external systems can inject item sale messages to queue, from which a first MQ source Kafka connector publishes the messages to the <code>items</code> Kafka topic. Items sold events are processed by a series of streaming microservices which publishes aggregation results to different topics. Those topics content could be which will be used by Sink connectors to send records to other external systems.</p> <p><img alt=1 src=images/kconnect-overview.png></p> <h2 id=general-pre-requisites>General pre-requisites<a class=headerlink href=#general-pre-requisites title="Permanent link">&para;</a></h2> <ul> <li>Get access to an OpenShift Cluster. All the CLI commands must be performed by a Cluster administrator. You need <code>oc cli</code> and the <code>jq</code> JSON stream editor installed.</li> <li><a href=https://docs.openshift.com/container-platform/4.7/cli_reference/openshift_cli/getting-started-cli.html>OpenShift CLI</a> on your local environment.</li> <li><a href=https://stedolan.github.io/jq/ >jq</a> on your local environment.</li> <li><a href=https://docs.docker.com/ >Docker</a> and docker compose to run the solution locally.</li> <li><a href=https://git-scm.com/downloads>git CLI</a>.</li> <li>Clone this repository</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>git clone https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops.git
</code></pre></div> <p>For OpenShift deployment, you need access to a cluster with storage capabilities to support Event Streams deployments like block storage configured to use the XFS or ext4 file system, as described in <a href=https://ibm.github.io/event-streams/installing/prerequisites/#data-storage-requirements>Event Streams storage</a>.</p> <p>You need to have at least one volume per broker and one per zookeeper instance.</p> <p>See also the <a href="https://www.ibm.com/docs/guide/viewer/public/cloud-paks/cp-integration/2021.4?interact=installing-cloud-pak-for-integration&utm_source=guide">interactive Installation Guide for cloud pak for integration</a>. </p> <h2 id=a-gitops-approach-for-solution-deployment>A GitOps approach for solution deployment<a class=headerlink href=#a-gitops-approach-for-solution-deployment title="Permanent link">&para;</a></h2> <p>As any cloud-native and kubernetes based solution, we use continuous integration and continuous deployment practices. From a demonstration point of view, the most interesting part is to execute continuous deployment using a <a href=https://ibm-cloud-architecture.github.io/refarch-eda/use-cases/gitops/ >GitOps approach</a> as presented in the EDA reference. </p> <p>See the specific explanation in <a href=gitops/ >this section.</a></p> <h2 id=choose-a-runtime-option>Choose a runtime option<a class=headerlink href=#choose-a-runtime-option title="Permanent link">&para;</a></h2> <p>We try to make the business scenario, easily demonstrable by enablind developer's laptop execution with docker compose or use a simple free OpenShift Cluster on IBM cloud.</p> <ul> <li><a href=./#run-the-solution-locally>Run on your laptop</a></li> <li><a href=./gitops/#gitops-on-new-openshift-cluster>Use GitOps on a new OpenShift Cluster</a></li> <li><a href=./gitops/#deploy-in-an-existing-cp4i-deployment>Use Gitops on existing Cloud Pak Integration (multi-tenant)</a></li> <li><a href=./#deploy-on-a-brand-new-openshift-cluster>Without GitOps, just yaml, on a new OpenShift Cluster</a></li> <li><a href=./#deploy-on-multi-tenant-environment>Without GitOps, just yaml, on existing Cloud Pak Integration (multi-tenant)</a></li> </ul> <h2 id=a-non-gitops-approach>A non gitops approach<a class=headerlink href=#a-non-gitops-approach title="Permanent link">&para;</a></h2> <h3 id=deploy-on-a-brand-new-openshift-cluster>Deploy on a brand new OpenShift cluster<a class=headerlink href=#deploy-on-a-brand-new-openshift-cluster title="Permanent link">&para;</a></h3> <p>The makefile in this repository supports the minimum commands to use to deploy the different components:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># [optional]: prepare entitlementkey,  IBM catalog </span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>make prepare
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=c1># [optional]: install the  different cp4i operators</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>make install_cp4i_operators
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1># Deploy the dev environment</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>make deploy_rt_inventory
</code></pre></div> <h3 id=deploy-on-multi-tenant-environment>Deploy on multi-tenant environment<a class=headerlink href=#deploy-on-multi-tenant-environment title="Permanent link">&para;</a></h3> <p>The same makefile supports also to deploy to an existing Cloud Pak for Integration deployment with Event Streams being part of a namespace named <code>cp4i-eventstreams</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># Deploy all apps in rt-inventory-dev but use cp4i-eventstreams</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>make multi_tenants
</code></pre></div> <h2 id=two-different-streaming-approaches>Two different streaming approaches<a class=headerlink href=#two-different-streaming-approaches title="Permanent link">&para;</a></h2> <p>We propose two approaches to develop the streaming processing. </p> <ul> <li>One using Kafka Streams with two applications</li> <li>One using Apache Flink</li> </ul> <h3 id=kafka-streams-implementation>Kafka Streams implementation<a class=headerlink href=#kafka-streams-implementation title="Permanent link">&para;</a></h3> <ul> <li>The Item-aggregator, based on Kafka Stream APIs, is in this project: <a href=https://github.com/ibm-cloud-architecture/refarch-eda-item-inventory>refarch-eda-item-inventory</a></li> <li>The Store-aggregator, also based on Kafka Stream APIs, is in this project: <a href=https://github.com/ibm-cloud-architecture/refarch-eda-store-inventory>refarch-eda-store-inventory</a></li> </ul> <h3 id=fink-implementation>Fink implementation<a class=headerlink href=#fink-implementation title="Permanent link">&para;</a></h3> <p>See <a href=https://github.com/ibm-cloud-architecture/refarch-eda-item-inventory-sql-flink>the refarch-eda-item-inventory-sql-flink repository</a> for more information.</p> <h2 id=run-the-solution-locally>Run the solution locally<a class=headerlink href=#run-the-solution-locally title="Permanent link">&para;</a></h2> <p>As a developer or technical seller, you could demonstrate this scenario on your laptop using MQ and Event Streams docker images. The docker images for each custom microservices used in this solution are in public registry (<a href=https://recovery.quay.io/organization/ibmcase>Quay.io</a>).</p> <p>Under this repository the <code>local-demo/kstream</code> folder has different docker compose files to run different components:</p> <ul> <li><a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/tree/main/local-demo/kstreams/docker-compose.yaml>docker-compose.yaml</a> for Event Streams, IBM MQ, Kafka Connector the Store Simulator App, the Item aggregator App, the Store aggregator App, and KafDrop to get a user interface to Kafka.</li> <li><a href=https://github.com/ibm-cloud-architecture/eda-rt-inventory-gitops/tree/main/local-demo/kstreams/docker-compose-all.yaml>docker-compose-all.yaml</a> same as above plus ElasticSearch (1 node) and Kibana</li> </ul> <p>Once you have cloned the gitops repository (see pre-requisites section), go under the <code>local-demo/kstreams</code> </p> <ul> <li>Start local kafka, with the 3 apps, MQ and ElasticSearch services run</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nb>cd</span> local-demo/kstreams
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>docker-compose -f docker-compose-all.yaml up -d
</code></pre></div> <ul> <li>As an alternate to only start Kafka, MQ and the 3 apps run:</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nb>cd</span> local-demo/kstreams
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>docker-compose up -d
</code></pre></div> <ul> <li>As another alternate without MQ and elasticSearch:</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=nb>cd</span> local-demo/kstreams
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>docker-compose -f docker-compose-kafka.yaml up -d
</code></pre></div> <h3 id=demonstration-script-for-local>Demonstration script for local<a class=headerlink href=#demonstration-script-for-local title="Permanent link">&para;</a></h3> <p>The demonstration script is the <a href=demo-script/ >same as the one described in this chapter</a>, except that we use Kafdrop to visualize the content of Event Streams topics. </p> <p>Use the simulator the console is: <a href=http://localhost:8080/ >http://localhost:8080/#/</a>.</p> <p>If you run the controlled scenario the data are:</p> <table> <thead> <tr> <th>Store</th> <th>Item</th> <th>Action</th> </tr> </thead> <tbody> <tr> <td>Store 1</td> <td>Item_1</td> <td>+10</td> </tr> <tr> <td>Store 1</td> <td>Item_2</td> <td>+5</td> </tr> <tr> <td>Store 1</td> <td>Item_3</td> <td>+15</td> </tr> <tr> <td>Store 2</td> <td>Item_1</td> <td>+10</td> </tr> <tr> <td>Store 3</td> <td>Item_1</td> <td>+10</td> </tr> <tr> <td>Store 4</td> <td>Item_1</td> <td>+10</td> </tr> <tr> <td>Store 5</td> <td>Item_1</td> <td>+10</td> </tr> <tr> <td>Store 1</td> <td>Item_2</td> <td>-5</td> </tr> <tr> <td>Store 1</td> <td>Item_3</td> <td>-5</td> </tr> </tbody> </table> <p>Inventory should be at the store level: <code>{"stock":{"Item_3":10,"Item_2":0,"Item_1":10},"storeName":"Store_1"}</code> and at the item level:</p> <table> <thead> <tr> <th>Item</th> <th>Stock</th> </tr> </thead> <tbody> <tr> <td>Item_1</td> <td>50</td> </tr> <tr> <td>Item_2</td> <td>0</td> </tr> <tr> <td>Item_3</td> <td>10</td> </tr> </tbody> </table> <p>The store inventory API is at <a href=http://localhost:8082/q/swagger-ui>http://localhost:8082</a></p> <p>The item inventory API is at <a href=http://localhost:8081/q/swagger-ui>http://localhost:8081</a></p> <p>Kafdrop UI to see messages in <code>items</code>, <code>store.inventory</code> and <code>item.inventory</code> topics is at <a href=http://localhost:9000>http://localhost:9000</a></p> <ul> <li>Verify Events are in <code>items</code> topic using Kafdrop:</li> </ul> <p><img alt src=images/items-content.png></p> <ul> <li>Verify item inventory events are in <code>item-inventory</code></li> </ul> <p><img alt src=images/item-inventory-content.png></p> <ul> <li>Finally verify item inventory events are in <code>store-inventory</code></li> </ul> <p><img alt src=images/store-inventory-content.png></p> <ul> <li> <p>If using ElasticSearch go to Kibana UI at <a href=http://localhost:5601>localhost:5601</a></p> </li> <li> <p>Stop the demo: select one of the following command:</p> </li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>docker-compose -f docker-compose-all.yaml down
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=c1># OR</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>docker-compose  down
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=c1># OR</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>docker-compose -f docker-compose-kafka.yaml down
</code></pre></div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=demo-script/ class="md-footer__link md-footer__link--next" aria-label="Next: Demonstration script" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Demonstration script </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": ".", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.indexes", "navigation.tracking", "navigation.tabs.sticky"], "search": "assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=assets/javascripts/bundle.9c69f0bc.min.js></script> </body> </html>